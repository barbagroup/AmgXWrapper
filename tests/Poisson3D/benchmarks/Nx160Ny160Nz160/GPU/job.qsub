#!/bin/bash

#SBATCH --job-name="Nx160Ny160Nz160_GPU"
#SBATCH --nodes=8
#SBATCH --ntasks-per-node=2
#SBATCH --time=04:00:00
#SBATCH --output=result.out
#SBATCH --error=error.err
#SBATCH --partition=ivygpu-noecc

module load openmpi/1.8/gcc/4.7/cuda
module load cuda/toolkit/6.5
module load boost/1.56
module load lapack/gcc
module load blas/gcc

export LM_LICENSE_FILE=/home/pychuang/myPackages/AmgX/amgx_trial-exp-Mar-31-2016.lic
export LD_LIBRARY_PATH=/home/pychuang/myPackages/AmgX/lib:$LD_LIBRARY_PATH
export BIN=/home/pychuang/AmgXWrapper/tests/bin/Poisson3D
export CASE=Nx160Ny160Nz160_GPU
export MODE=GPU
export NGPU=16
export Nx=160
export Ny=160
export Nz=160
export CONF=/home/pychuang/AmgXWrapper/tests/configs/AmgX_V_HMIS_LU_0.8.info

mpiexec -n ${NGPU} -map-by ppr:2:node ${BIN} -caseName ${CASE}${NGPU} -mode ${MODE} -Nx ${Nx} -Ny ${Ny} -Nz ${Nz} -cfgFileName ${CONF} -optFileName perf_${CASE}${NGPU}
