#!/bin/bash

#SBATCH --job-name="Nx1000Ny500Nz200_GPU32"
#SBATCH --nodes=16
#SBATCH --ntasks-per-node=2
#SBATCH --time=00:20:00
#SBATCH --output=results/Nx1000Ny500Nz200_GPU32.result
#SBATCH --error=errors/Nx1000Ny500Nz200_GPU32.error
#SBATCH --partition=ivygpu-noecc

source moduleLoad.sh

export LM_LICENSE_FILE=/groups/barbalab/pychuang/AmgX/amgx_trial-exp-Mar-31-2016.lic
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/groups/barbalab/pychuang/AmgX/lib

export BIN=../bin/Poisson3D
export MODE=GPU
export CONF=../configs/AmgX_V_HMIS_LU_0.8.info
export Nx=1000
export Ny=500
export Nz=200
export CASE=Nx${Nx}Ny${Ny}Nz${Nz}_${MODE}

export NPROC=32

for((i=1;i<=5;i++))
do

mpiexec -n ${NPROC} -map-by ppr:2:node ${BIN} -caseName ${CASE}${NPROC} -mode ${MODE} -Nx ${Nx} -Ny ${Ny} -Nz ${Nz} -cfgFileName ${CONF} -optFileName logs/perf_${CASE}${NPROC}_Loop${i}.log

done
